<div class="flex h-screen overflow-hidden bg-whatsapp-gray">
  <!-- Sidebar -->
  <div class="w-full md:flex flex-col border-r border-gray-700 bg-whatsapp-dark relative"
       [ngClass]="{'hidden md:flex': hasSelectedChat}"
       [style.width.px]="sidebarWidth">
    <!-- User Profile Header -->
    <div class="bg-whatsapp-gray px-4 py-3 border-b border-gray-700 shrink-0">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-3 flex-1 min-w-0" *ngIf="currentAgent">
          <div class="w-10 h-10 rounded-full overflow-hidden bg-gray-600 flex-shrink-0">
            <img *ngIf="currentAgent.avatar" [src]="currentAgent.avatar" [alt]="currentAgent.firstName" class="w-full h-full object-cover">
            <div *ngIf="!currentAgent.avatar" class="w-full h-full flex items-center justify-center text-white font-medium">
              {{ (currentAgent.firstName || 'A')[0] }}{{ (currentAgent.lastName || '')[0] }}
            </div>
          </div>
          <div class="flex-1 min-w-0">
            <h3 class="text-gray-100 font-medium text-sm truncate">{{ currentAgent.firstName }} {{ currentAgent.lastName }}</h3>
            <p class="text-xs text-gray-400 truncate">{{ currentAgent.email }}</p>
          </div>
        </div>
        <div class="relative flex-shrink-0">
          <button (click)="toggleMenu()"
                  class="text-gray-400 hover:text-gray-200 transition-colors p-2 rounded-full hover:bg-whatsapp-dark"
                  title="Menu">
            <i class="fas fa-ellipsis-v text-lg"></i>
          </button>

          <!-- Dropdown Menu -->
          <div *ngIf="showMenu"
               class="absolute right-0 mt-2 w-56 bg-whatsapp-dark border border-gray-700 rounded-lg shadow-xl z-50 py-2">
            <div class="px-4 py-3 border-b border-gray-700">
              <p class="text-xs text-gray-400 uppercase tracking-wide">Account</p>
            </div>

            <button (click)="viewProfile()"
                    class="w-full px-4 py-3 text-left hover:bg-whatsapp-gray transition-colors flex items-center gap-3 text-gray-200">
              <i class="fas fa-user w-5"></i>
              <span>My Profile</span>
            </button>

            <button (click)="viewSettings()"
                    class="w-full px-4 py-3 text-left hover:bg-whatsapp-gray transition-colors flex items-center gap-3 text-gray-200">
              <i class="fas fa-cog w-5"></i>
              <span>Settings</span>
            </button>

            <div class="border-t border-gray-700 my-2"></div>

            <!-- Auto-Assign Toggle -->
            <div class="px-4 py-3">
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-3 text-gray-200">
                  <i class="fas fa-user-clock w-5"></i>
                  <span class="text-sm">Auto-Assign</span>
                </div>
                <button
                  (click)="toggleAutoAssign()"
                  class="relative inline-flex h-6 w-11 items-center rounded-full transition-colors"
                  [ngClass]="currentAgent?.autoAssign ? 'bg-green-600' : 'bg-gray-600'">
                  <span
                    class="inline-block h-4 w-4 transform rounded-full bg-white transition-transform"
                    [ngClass]="currentAgent?.autoAssign ? 'translate-x-6' : 'translate-x-1'">
                  </span>
                </button>
              </div>
              <p class="text-xs text-gray-400 mt-1 ml-8">
                {{ currentAgent?.autoAssign ? 'Available for customer requests' : 'Not accepting new assignments' }}
              </p>
            </div>

            <div class="border-t border-gray-700 my-2"></div>

            <button (click)="logout()"
                    class="w-full px-4 py-3 text-left hover:bg-red-900/30 transition-colors flex items-center gap-3 text-red-400">
              <i class="fas fa-sign-out-alt w-5"></i>
              <span>Logout</span>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Overlay to close menu -->
    <div *ngIf="showMenu"
         (click)="closeMenu()"
         class="fixed inset-0 z-40"></div>

    <app-chat-list class="flex-1 overflow-hidden"></app-chat-list>

    <!-- Resize Handle -->
    <div class="hidden md:block absolute top-0 right-0 w-1 h-full cursor-col-resize hover:bg-whatsapp-green hover:w-1.5 transition-all z-10 group"
         (mousedown)="startResize($event)"
         [class.bg-whatsapp-green]="isResizing">
      <div class="absolute right-0 top-1/2 -translate-y-1/2 w-1 h-12 bg-gray-600 group-hover:bg-whatsapp-green rounded-full transition-colors"></div>
    </div>
  </div>

  <!-- Main Chat Area -->
  <div class="flex flex-1 flex-col bg-whatsapp-dark relative"
       [ngClass]="{'flex': hasSelectedChat, 'hidden md:flex': !hasSelectedChat}">
    <!-- Background Pattern -->
    <div class="absolute inset-0 opacity-5 pointer-events-none"
         style="background-image: url('https://user-images.githubusercontent.com/15075759/28719144-86dc0f70-73b1-11e7-911d-60d70fcded21.png');">
    </div>

    <!-- Mobile Back Button -->
    <button *ngIf="hasSelectedChat"
            (click)="backToList()"
            class="md:hidden absolute top-4 left-4 z-20 bg-whatsapp-gray/80 backdrop-blur-sm text-gray-200 p-2 rounded-full shadow-lg hover:bg-whatsapp-gray transition-colors">
      <i class="fas fa-arrow-left"></i>
    </button>

    <app-chat-window class="flex-1 overflow-hidden z-10"></app-chat-window>
  </div>
</div>
